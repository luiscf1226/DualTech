FROM mcr.microsoft.com/mssql/server:2022-latest

USER root

# Copy initialization scripts
COPY init-db.sql /docker-entrypoint-initdb.d/
COPY setup-db.sh /docker-entrypoint-initdb.d/

# Make the script executable
RUN chmod +x /docker-entrypoint-initdb.d/setup-db.sh

# Create a directory for the entrypoint script
RUN mkdir -p /usr/local/bin/

# Create an entrypoint script
RUN echo '#!/bin/bash \n\
/docker-entrypoint-initdb.d/setup-db.sh & \n\
/opt/mssql/bin/sqlservr' > /usr/local/bin/entrypoint.sh

# Make the entrypoint script executable
RUN chmod +x /usr/local/bin/entrypoint.sh

USER mssql

ENTRYPOINT ["/usr/local/bin/entrypoint.sh"] 